name: CI

on:
  pull_request:
  push:
    branches: [ main ]

jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Markdown lint
        uses: avto-dev/markdown-lint@v1
        with:
          args: 'docs/**/*.md README.md CONTRIBUTING.md SECURITY.md'

      - name: Link check
        uses: lycheeverse/lychee-action@v1
        with:
          args: '--verbose --no-progress docs/**/*.md README.md'
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Verify Mermaid blocks
        run: |
          rg "```mermaid" docs README.md

      - name: Validate JSON formatting
        run: |
          for file in $(rg --files -g '*.json' impl); do
            jq empty "$file"
          done
